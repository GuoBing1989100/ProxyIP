<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProxyIP Filter - Êô∫ËÉΩ‰ª£ÁêÜIPÁ≠õÈÄâÂô®</title>
    <style>
        :root {
            --primary-color: #667eea;
            --primary-dark: #5568d3;
            --secondary-color: #764ba2;
            --success-color: #48bb78;
            --danger-color: #f56565;
            --warning-color: #ed8936;
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-hover: rgba(255, 255, 255, 1);
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }

        [data-theme="dark"] {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --card-bg: rgba(31, 41, 55, 0.95);
            --card-hover: rgba(31, 41, 55, 1);
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --border-color: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: 28px;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .theme-toggle, .refresh-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            min-height: 44px;
        }

        .theme-toggle:hover, .refresh-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .last-update {
            color: rgba(255,255,255,0.9);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        /* Statistics Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            background: var(--card-bg);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: var(--spacing-sm);
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            font-feature-settings: 'tnum';
        }

        /* Filter Section */
        .filter-section {
            background: var(--card-bg);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--spacing-lg);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .filter-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .search-box {
            margin-bottom: var(--spacing-md);
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            gap: var(--spacing-sm);
        }

        .search-input {
            flex: 1;
            padding: 12px 16px 12px 40px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        [data-theme="dark"] .search-input {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 18px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
        }

        [data-theme="dark"] .filter-select,
        [data-theme="dark"] .filter-input {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .advanced-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            padding: var(--spacing-sm);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            transition: all 0.3s ease;
        }

        .advanced-toggle:hover {
            opacity: 0.8;
        }

        .advanced-filters {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .advanced-filters.active {
            max-height: 500px;
            margin-top: var(--spacing-md);
        }

        .filter-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--text-secondary);
            color: white;
        }

        .filter-result {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
        }

        .saved-filters {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-md);
        }

        .saved-filter-tag {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .saved-filter-tag:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .saved-filter-tag .remove {
            cursor: pointer;
            opacity: 0.6;
        }

        .saved-filter-tag .remove:hover {
            opacity: 1;
        }

        /* Table Section */
        .table-section {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .table-header {
            padding: var(--spacing-lg);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .table-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .table-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            position: sticky;
            top: 0;
            background: var(--card-bg);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        th {
            padding: var(--spacing-md);
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }

        th:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        th.sortable::after {
            content: ' ‚Üï';
            opacity: 0.3;
        }

        th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
            color: var(--primary-color);
        }

        th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
            color: var(--primary-color);
        }

        tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        tbody tr:nth-child(even) {
            background: rgba(0,0,0,0.02);
        }

        [data-theme="dark"] tbody tr:nth-child(even) {
            background: rgba(255,255,255,0.02);
        }

        tbody tr:hover {
            background: rgba(102, 126, 234, 0.08);
            transform: scale(1.01);
        }

        td {
            padding: var(--spacing-md);
            font-size: 14px;
        }

        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .ip-cell {
            font-family: 'Monaco', 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary-color);
        }

        .country-cell {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-xs);
        }

        .icon-btn {
            background: none;
            border: 1px solid var(--border-color);
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            min-width: 36px;
            min-height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .icon-btn.copy {
            color: var(--primary-color);
        }

        .icon-btn.favorite {
            color: var(--warning-color);
        }

        .icon-btn.favorite.active {
            background: var(--warning-color);
            color: white;
            border-color: var(--warning-color);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 36px;
            min-height: 36px;
        }

        [data-theme="dark"] .page-btn {
            background: rgba(255,255,255,0.05);
        }

        .page-btn:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: var(--radius-sm);
        }

        [data-theme="dark"] .skeleton {
            background: linear-gradient(90deg, #2d3748 25%, #1a202c 50%, #2d3748 75%);
            background-size: 200% 100%;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-row {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .skeleton-cell {
            height: 20px;
            flex: 1;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            background: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--danger-color);
        }

        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }

        /* Mobile Card View */
        .card-view {
            display: none;
        }

        @media (max-width: 768px) {
            .table-wrapper {
                display: none;
            }

            .card-view {
                display: block;
                padding: var(--spacing-md);
            }

            .proxy-card {
                background: white;
                padding: var(--spacing-md);
                border-radius: var(--radius-md);
                margin-bottom: var(--spacing-md);
                box-shadow: var(--shadow-sm);
                border-left: 4px solid var(--primary-color);
            }

            [data-theme="dark"] .proxy-card {
                background: rgba(255,255,255,0.05);
            }

            .proxy-card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: var(--spacing-sm);
            }

            .proxy-card-ip {
                font-family: 'Monaco', 'Courier New', monospace;
                font-weight: 700;
                color: var(--primary-color);
                font-size: 16px;
            }

            .proxy-card-body {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-sm);
                margin-bottom: var(--spacing-sm);
                font-size: 13px;
            }

            .proxy-card-label {
                color: var(--text-secondary);
                font-weight: 600;
            }

            .proxy-card-actions {
                display: flex;
                gap: var(--spacing-sm);
                justify-content: flex-end;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-lg);
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }

        .footer a {
            color: white;
            text-decoration: underline;
            font-weight: 600;
        }

        .footer a:hover {
            opacity: 0.8;
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            min-width: 160px;
            box-shadow: var(--shadow-lg);
            border-radius: var(--radius-md);
            z-index: 100;
            overflow: hidden;
        }

        [data-theme="dark"] .dropdown-content {
            background: var(--card-bg);
        }

        .dropdown.active .dropdown-content {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        /* Utility Classes */
        .text-success { color: var(--success-color); }
        .text-danger { color: var(--danger-color); }
        .text-warning { color: var(--warning-color); }
        .hidden { display: none; }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <span>üöÄ</span>
                <span>ProxyIP Filter</span>
            </div>
            <div class="header-actions">
                <div class="last-update">
                    <span>‚è∞</span>
                    <span id="lastUpdate">Âä†ËΩΩ‰∏≠...</span>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="themeIcon">üåô</span>
                    <span id="themeText">ÊöóÈªëÊ®°Âºè</span>
                </button>
                <button class="refresh-btn" onclick="refreshData()">
                    <span>üîÑ</span>
                    <span>Âà∑Êñ∞Êï∞ÊçÆ</span>
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-label">ÊÄª‰ª£ÁêÜÊï∞</div>
                <div class="stat-value" id="totalProxies">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåç</div>
                <div class="stat-label">ÂõΩÂÆ∂Êï∞Èáè</div>
                <div class="stat-value" id="totalCountries">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-label">Á≠õÈÄâÁªìÊûú</div>
                <div class="stat-value" id="filteredCount">0</div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-header">
                <div class="filter-title">
                    <span>üîç</span>
                    <span>Êô∫ËÉΩÁ≠õÈÄâ</span>
                </div>
                <button class="btn btn-secondary" onclick="saveCurrentFilter()">
                    üíæ ‰øùÂ≠òÁ≠õÈÄâ
                </button>
            </div>

            <!-- Saved Filters -->
            <div class="saved-filters" id="savedFilters"></div>

            <!-- Search Box -->
            <div class="search-box">
                <div class="search-input-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" 
                           class="search-input" 
                           id="searchInput" 
                           placeholder="ÊêúÁ¥¢ IP„ÄÅÂõΩÂÆ∂„ÄÅISP..."
                           oninput="handleSearch()">
                </div>
            </div>

            <!-- Basic Filters -->
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">üåç ÂõΩÂÆ∂/Âú∞Âå∫</label>
                    <select class="filter-select" id="countryFilter" onchange="applyFilters()">
                        <option value="">ÂÖ®ÈÉ®ÂõΩÂÆ∂</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">üîå Á´ØÂè£</label>
                    <input type="text" class="filter-input" id="portFilter" placeholder="ËæìÂÖ•Á´ØÂè£..." oninput="handleSearch()">
                </div>
                <div class="filter-group">
                    <label class="filter-label">üè¢ ISP/ÂÖ¨Âè∏</label>
                    <input type="text" class="filter-input" id="ispFilter" placeholder="ËæìÂÖ•ISP..." oninput="handleSearch()">
                </div>
                <div class="filter-group">
                    <label class="filter-label">‚≠ê Êî∂Ëóè</label>
                    <select class="filter-select" id="favoriteFilter" onchange="applyFilters()">
                        <option value="">ÂÖ®ÈÉ®</option>
                        <option value="favorites">‰ªÖÊî∂Ëóè</option>
                    </select>
                </div>
            </div>

            <!-- Filter Actions -->
            <div class="filter-actions">
                <div style="display: flex; gap: var(--spacing-sm);">
                    <button class="btn btn-secondary" onclick="resetFilters()">
                        üîÑ ÈáçÁΩÆÁ≠õÈÄâ
                    </button>
                    <button class="btn btn-primary" onclick="applyFilters()">
                        ‚ú® Â∫îÁî®Á≠õÈÄâ
                    </button>
                </div>
                <div class="filter-result">
                    <span>ÂΩìÂâçÊòæÁ§∫: </span>
                    <span id="currentCount">0</span>
                    <span> / </span>
                    <span id="totalCount">0</span>
                    <span> Êù°‰ª£ÁêÜ</span>
                </div>
            </div>
        </div>

        <!-- Table Section -->
        <div class="table-section">
            <div class="table-header">
                <div class="table-title">
                    <span>üìã</span>
                    <span>‰ª£ÁêÜÂàóË°®</span>
                </div>
                <div class="table-actions">
                    <div class="dropdown">
                        <button class="btn btn-secondary" onclick="toggleDropdown('batchDropdown')">
                            ‚òëÔ∏è ÊâπÈáèÊìç‰Ωú ‚ñº
                        </button>
                        <div class="dropdown-content" id="batchDropdown">
                            <div class="dropdown-item" onclick="selectAll()">ÂÖ®ÈÄâ</div>
                            <div class="dropdown-item" onclick="deselectAll()">ÂèñÊ∂àÂÖ®ÈÄâ</div>
                            <div class="dropdown-item" onclick="copySelected()">Â§çÂà∂ÈÄâ‰∏≠</div>
                            <div class="dropdown-item" onclick="exportSelected()">ÂØºÂá∫ÈÄâ‰∏≠</div>
                        </div>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-secondary" onclick="toggleDropdown('exportDropdown')">
                            üì• ÂØºÂá∫ ‚ñº
                        </button>
                        <div class="dropdown-content" id="exportDropdown">
                            <div class="dropdown-item" onclick="exportData('txt')">ÂØºÂá∫‰∏∫ TXT</div>
                            <div class="dropdown-item" onclick="exportData('csv')">ÂØºÂá∫‰∏∫ CSV</div>
                            <div class="dropdown-item" onclick="exportData('json')">ÂØºÂá∫‰∏∫ JSON</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Desktop Table View -->
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th class="checkbox-cell">
                                <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                            </th>
                            <th class="sortable" onclick="sortTable('ip')">IPÂú∞ÂùÄ</th>
                            <th class="sortable" onclick="sortTable('port')">Á´ØÂè£</th>
                            <th class="sortable" onclick="sortTable('country')">ÂõΩÂÆ∂</th>
                            <th class="sortable" onclick="sortTable('isp')">ISP/ÂÖ¨Âè∏</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Loading skeleton -->
                        <tr class="skeleton-row">
                            <td><div class="skeleton skeleton-cell"></div></td>
                            <td><div class="skeleton skeleton-cell"></div></td>
                            <td><div class="skeleton skeleton-cell"></div></td>
                            <td><div class="skeleton skeleton-cell"></div></td>
                            <td><div class="skeleton skeleton-cell"></div></td>
                            <td><div class="skeleton skeleton-cell"></div></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div class="card-view" id="cardView">
                <!-- Cards will be generated here -->
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Êï∞ÊçÆÊù•Ê∫ê: <a href="https://github.com/GuoBing1989100/ProxyIP" target="_blank">GuoBing1989100/ProxyIP</a></p>
            <p>ÊîØÊåÅÁ¶ªÁ∫ø‰ΩøÁî® | Made with ‚ù§Ô∏è</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toastIcon"></span>
        <span id="toastMessage"></span>
    </div>

    <script>
// ÂõΩÂÆ∂‰ª£Á†Å‰∏≠ÊñáÊò†Â∞Ñ
const countryNames = {
    'AD': 'ÂÆâÈÅìÂ∞î', 'AE': 'ÈòøËÅîÈÖã', 'AF': 'ÈòøÂØåÊ±ó', 'AG': 'ÂÆâÊèêÁìúÂíåÂ∑¥Â∏ÉËææ',
    'AI': 'ÂÆâÂú≠Êãâ', 'AL': 'ÈòøÂ∞îÂ∑¥Â∞º‰∫ö', 'AM': '‰∫öÁæéÂ∞º‰∫ö', 'AO': 'ÂÆâÂì•Êãâ',
    'AQ': 'ÂçóÊûÅÊ¥≤', 'AR': 'ÈòøÊ†πÂª∑', 'AS': 'ÁæéÂ±ûËê®Êë©‰∫ö', 'AT': 'Â••Âú∞Âà©',
    'AU': 'Êæ≥Â§ßÂà©‰∫ö', 'AW': 'ÈòøÈ≤ÅÂ∑¥', 'AX': 'Â••ÂÖ∞Áæ§Â≤õ', 'AZ': 'ÈòøÂ°ûÊãúÁñÜ',
    'BA': 'Ê≥¢Èªë', 'BB': 'Â∑¥Â∑¥Â§öÊñØ', 'BD': 'Â≠üÂä†ÊãâÂõΩ', 'BE': 'ÊØîÂà©Êó∂',
    'BF': 'Â∏ÉÂü∫Á∫≥Ê≥ïÁ¥¢', 'BG': '‰øùÂä†Âà©‰∫ö', 'BH': 'Â∑¥Êûó', 'BI': 'Â∏ÉÈöÜËø™',
    'BJ': 'Ë¥ùÂÆÅ', 'BL': 'Âú£Â∑¥Ê≥∞ÂãíÁ±≥', 'BM': 'ÁôæÊÖïÂ§ß', 'BN': 'ÊñáËé±',
    'BO': 'ÁéªÂà©Áª¥‰∫ö', 'BQ': 'Ëç∑ÂÖ∞Âä†ÂãíÊØî', 'BR': 'Â∑¥Ë•ø', 'BS': 'Â∑¥ÂìàÈ©¨',
    'BT': '‰∏ç‰∏π', 'BV': 'Â∏ÉÈü¶Â≤õ', 'BW': 'ÂçöËå®Áì¶Á∫≥', 'BY': 'ÁôΩ‰øÑÁΩóÊñØ',
    'BZ': '‰ºØÂà©ÂÖπ', 'CA': 'Âä†ÊãøÂ§ß', 'CC': 'ÁßëÁßëÊñØÁæ§Â≤õ', 'CD': 'ÂàöÊûú(Èáë)',
    'CF': '‰∏≠Èùû', 'CG': 'ÂàöÊûú(Â∏É)', 'CH': 'ÁëûÂ£´', 'CI': 'ÁßëÁâπËø™Áì¶',
    'CK': 'Â∫ìÂÖãÁæ§Â≤õ', 'CL': 'Êô∫Âà©', 'CM': 'ÂñÄÈ∫¶ÈöÜ', 'CN': '‰∏≠ÂõΩ',
    'CO': 'Âì•‰º¶ÊØî‰∫ö', 'CR': 'Âì•ÊñØËææÈªéÂä†', 'CU': 'Âè§Â∑¥', 'CV': '‰ΩõÂæóËßí',
    'CW': 'Â∫ìÊãâÁ¥¢', 'CX': 'Âú£ËØûÂ≤õ', 'CY': 'Â°ûÊµ¶Ë∑ØÊñØ', 'CZ': 'Êç∑ÂÖã',
    'DE': 'Âæ∑ÂõΩ', 'DJ': 'ÂêâÂ∏ÉÊèê', 'DK': '‰∏πÈ∫¶', 'DM': 'Â§öÁ±≥Â∞ºÂÖã',
    'DO': 'Â§öÁ±≥Â∞ºÂä†', 'DZ': 'ÈòøÂ∞îÂèäÂà©‰∫ö', 'EC': 'ÂéÑÁìúÂ§öÂ∞î', 'EE': 'Áà±Ê≤ôÂ∞º‰∫ö',
    'EG': 'ÂüÉÂèä', 'EH': 'Ë•øÊííÂìàÊãâ', 'ER': 'ÂéÑÁ´ãÁâπÈáå‰∫ö', 'ES': 'Ë•øÁè≠Áâô',
    'ET': 'ÂüÉÂ°û‰øÑÊØî‰∫ö', 'FI': 'Ëä¨ÂÖ∞', 'FJ': 'ÊñêÊµé', 'FK': 'Á¶èÂÖãÂÖ∞Áæ§Â≤õ',
    'FM': 'ÂØÜÂÖãÁΩóÂ∞ºË•ø‰∫ö', 'FO': 'Ê≥ïÁΩóÁæ§Â≤õ', 'FR': 'Ê≥ïÂõΩ', 'GA': 'Âä†Ëì¨',
    'GB': 'Ëã±ÂõΩ', 'GD': 'Ê†ºÊûóÁ∫≥Ëææ', 'GE': 'Ê†ºÈ≤ÅÂêâ‰∫ö', 'GF': 'Ê≥ïÂ±ûÂú≠‰∫öÈÇ£',
    'GG': 'Ê†πË•øÂ≤õ', 'GH': 'Âä†Á∫≥', 'GI': 'Áõ¥Â∏ÉÁΩóÈôÄ', 'GL': 'Ê†ºÈôµÂÖ∞',
    'GM': 'ÂÜàÊØî‰∫ö', 'GN': 'Âá†ÂÜÖ‰∫ö', 'GP': 'ÁìúÂæ∑ÁΩóÊôÆ', 'GQ': 'Ëµ§ÈÅìÂá†ÂÜÖ‰∫ö',
    'GR': 'Â∏åËÖä', 'GS': 'Âçó‰πîÊ≤ª‰∫ö', 'GT': 'Âç±Âú∞È©¨Êãâ', 'GU': 'ÂÖ≥Â≤õ',
    'GW': 'Âá†ÂÜÖ‰∫öÊØîÁªç', 'GY': 'Âú≠‰∫öÈÇ£', 'HK': '‰∏≠ÂõΩÈ¶ôÊ∏Ø', 'HM': 'Ëµ´Âæ∑Â≤õ',
    'HN': 'Ê¥™ÈÉΩÊãâÊñØ', 'HR': 'ÂÖãÁΩóÂú∞‰∫ö', 'HT': 'Êµ∑Âú∞', 'HU': 'ÂåàÁâôÂà©',
    'ID': 'Âç∞Â∫¶Â∞ºË•ø‰∫ö', 'IE': 'Áà±Â∞îÂÖ∞', 'IL': '‰ª•Ëâ≤Âàó', 'IM': 'È©¨ÊÅ©Â≤õ',
    'IN': 'Âç∞Â∫¶', 'IO': 'Ëã±Â±ûÂç∞Â∫¶Ê¥ãÈ¢ÜÂú∞', 'IQ': '‰ºäÊãâÂÖã', 'IR': '‰ºäÊúó',
    'IS': 'ÂÜ∞Â≤õ', 'IT': 'ÊÑèÂ§ßÂà©', 'JE': 'Ê≥ΩË•øÂ≤õ', 'JM': 'Áâô‰π∞Âä†',
    'JO': 'Á∫¶Êó¶', 'JP': 'Êó•Êú¨', 'KE': 'ËÇØÂ∞º‰∫ö', 'KG': 'ÂêâÂ∞îÂêâÊñØÊñØÂù¶',
    'KH': 'Êü¨ÂüîÂØ®', 'KI': 'Âü∫ÈáåÂ∑¥ÊñØ', 'KM': 'ÁßëÊë©ÁΩó', 'KN': 'Âú£Âü∫Ëå®ÂíåÂ∞ºÁª¥ÊñØ',
    'KP': 'ÊúùÈ≤ú', 'KR': 'Èü©ÂõΩ', 'KW': 'ÁßëÂ®ÅÁâπ', 'KY': 'ÂºÄÊõºÁæ§Â≤õ',
    'KZ': 'ÂìàËê®ÂÖãÊñØÂù¶', 'LA': 'ËÄÅÊåù', 'LB': 'ÈªéÂ∑¥Â´©', 'LC': 'Âú£Âç¢Ë•ø‰∫ö',
    'LI': 'ÂàóÊîØÊï¶Â£´Áôª', 'LK': 'ÊñØÈáåÂÖ∞Âç°', 'LR': 'Âà©ÊØîÈáå‰∫ö', 'LS': 'Ëé±Á¥¢Êâò',
    'LT': 'Á´ãÈô∂ÂÆõ', 'LU': 'Âç¢Ê£ÆÂ†°', 'LV': 'ÊãâËÑ±Áª¥‰∫ö', 'LY': 'Âà©ÊØî‰∫ö',
    'MA': 'Êë©Ê¥õÂì•', 'MC': 'Êë©Á∫≥Âì•', 'MD': 'Êë©Â∞îÂ§öÁì¶', 'ME': 'ÈªëÂ±±',
    'MF': 'Ê≥ïÂ±ûÂú£È©¨‰∏Å', 'MG': 'È©¨ËææÂä†ÊñØÂä†', 'MH': 'È©¨ÁªçÂ∞îÁæ§Â≤õ', 'MK': 'ÂåóÈ©¨ÂÖ∂È°ø',
    'ML': 'È©¨Èáå', 'MM': 'ÁºÖÁî∏', 'MN': 'ËíôÂè§', 'MO': '‰∏≠ÂõΩÊæ≥Èó®',
    'MP': 'ÂåóÈ©¨Èáå‰∫öÁ∫≥Áæ§Â≤õ', 'MQ': 'È©¨ÊèêÂ∞ºÂÖã', 'MR': 'ÊØõÈáåÂ°îÂ∞º‰∫ö', 'MS': 'ËíôÁâπÂ°ûÊãâÁâπ',
    'MT': 'È©¨ËÄ≥‰ªñ', 'MU': 'ÊØõÈáåÊ±ÇÊñØ', 'MV': 'È©¨Â∞î‰ª£Â§´', 'MW': 'È©¨ÊãâÁª¥',
    'MX': 'Â¢®Ë•øÂì•', 'MY': 'È©¨Êù•Ë•ø‰∫ö', 'MZ': 'Ëé´Ê°ëÊØîÂÖã', 'NA': 'Á∫≥Á±≥ÊØî‰∫ö',
    'NC': 'Êñ∞ÂñÄÈáåÂ§öÂ∞º‰∫ö', 'NE': 'Â∞ºÊó•Â∞î', 'NF': 'ËØ∫Á¶èÂÖãÂ≤õ', 'NG': 'Â∞ºÊó•Âà©‰∫ö',
    'NI': 'Â∞ºÂä†ÊãâÁìú', 'NL': 'Ëç∑ÂÖ∞', 'NO': 'Êå™Â®Å', 'NP': 'Â∞ºÊ≥äÂ∞î',
    'NR': 'ÁëôÈ≤Å', 'NU': 'Á∫ΩÂüÉ', 'NZ': 'Êñ∞Ë•øÂÖ∞', 'OM': 'ÈòøÊõº',
    'PA': 'Â∑¥ÊãøÈ©¨', 'PE': 'ÁßòÈ≤Å', 'PF': 'Ê≥ïÂ±ûÊ≥¢Âà©Â∞ºË•ø‰∫ö', 'PG': 'Â∑¥Â∏É‰∫öÊñ∞Âá†ÂÜÖ‰∫ö',
    'PH': 'Ëè≤ÂæãÂÆæ', 'PK': 'Â∑¥Âü∫ÊñØÂù¶', 'PL': 'Ê≥¢ÂÖ∞', 'PM': 'Âú£ÁöÆÂüÉÂ∞îÂíåÂØÜÂÖãÈöÜ',
    'PN': 'ÁöÆÁâπÂáØÊÅ©Áæ§Â≤õ', 'PR': 'Ê≥¢Â§öÈªéÂêÑ', 'PS': 'Â∑¥ÂãíÊñØÂù¶', 'PT': 'Ëë°ËêÑÁâô',
    'PW': 'Â∏ïÂä≥', 'PY': 'Â∑¥ÊãâÂú≠', 'QA': 'Âç°Â°îÂ∞î', 'RE': 'ÁïôÂ∞ºÊ±™',
    'RO': 'ÁΩóÈ©¨Â∞º‰∫ö', 'RS': 'Â°ûÂ∞îÁª¥‰∫ö', 'RU': '‰øÑÁΩóÊñØ', 'RW': 'Âç¢Êó∫Ëææ',
    'SA': 'Ê≤ôÁâπÈòøÊãâ‰ºØ', 'SB': 'ÊâÄÁΩóÈó®Áæ§Â≤õ', 'SC': 'Â°ûËàåÂ∞î', 'SD': 'Ëãè‰∏π',
    'SE': 'ÁëûÂÖ∏', 'SG': 'Êñ∞Âä†Âù°', 'SH': 'Âú£Ëµ´ÂãíÊãø', 'SI': 'ÊñØÊ¥õÊñáÂ∞º‰∫ö',
    'SJ': 'ÊñØÁì¶Â∞îÂ∑¥', 'SK': 'ÊñØÊ¥õ‰ºêÂÖã', 'SL': 'Â°ûÊãâÂà©ÊòÇ', 'SM': 'Âú£È©¨ÂäõËØ∫',
    'SN': 'Â°ûÂÜÖÂä†Â∞î', 'SO': 'Á¥¢È©¨Èáå', 'SR': 'ËãèÈáåÂçó', 'SS': 'ÂçóËãè‰∏π',
    'ST': 'Âú£Â§öÁæéÂíåÊôÆÊûóË•øÊØî', 'SV': 'Ëê®Â∞îÁì¶Â§ö', 'SX': 'Ëç∑Â±ûÂú£È©¨‰∏Å', 'SY': 'ÂèôÂà©‰∫ö',
    'SZ': 'ÊñØÂ®ÅÂ£´ÂÖ∞', 'TC': 'ÁâπÂÖãÊñØÂíåÂáØÁßëÊñØ', 'TD': '‰πçÂæó', 'TF': 'Ê≥ïÂ±ûÂçóÈÉ®È¢ÜÂú∞',
    'TG': 'Â§öÂì•', 'TH': 'Ê≥∞ÂõΩ', 'TJ': 'Â°îÂêâÂÖãÊñØÂù¶', 'TK': 'ÊâòÂÖãÂä≥',
    'TL': '‰∏úÂ∏ùÊ±∂', 'TM': 'ÂúüÂ∫ìÊõºÊñØÂù¶', 'TN': 'Á™ÅÂ∞ºÊñØ', 'TO': 'Ê±§Âä†',
    'TR': 'ÂúüËÄ≥ÂÖ∂', 'TT': 'ÁâπÁ´ãÂ∞ºËææÂíåÂ§öÂ∑¥Âì•', 'TV': 'ÂõæÁì¶Âç¢', 'TW': '‰∏≠ÂõΩÂè∞Êπæ',
    'TZ': 'Âù¶Ê°ëÂ∞º‰∫ö', 'UA': '‰πåÂÖãÂÖ∞', 'UG': '‰πåÂπ≤Ëææ', 'UM': 'ÁæéÂõΩÊú¨ÂúüÂ§ñÂ∞èÂ≤õÂ±ø',
    'US': 'ÁæéÂõΩ', 'UY': '‰πåÊãâÂú≠', 'UZ': '‰πåÂÖπÂà´ÂÖãÊñØÂù¶', 'VA': 'Ê¢µËíÇÂÜà',
    'VC': 'Âú£ÊñáÊ£ÆÁâπÂíåÊ†ºÊûóÁ∫≥‰∏ÅÊñØ', 'VE': 'ÂßîÂÜÖÁëûÊãâ', 'VG': 'Ëã±Â±ûÁª¥Â∞î‰∫¨Áæ§Â≤õ', 'VI': 'ÁæéÂ±ûÁª¥Â∞î‰∫¨Áæ§Â≤õ',
    'VN': 'Ë∂äÂçó', 'VU': 'Áì¶Âä™ÈòøÂõæ', 'WF': 'Áì¶Âà©ÊñØÂíåÂØåÂõæÁ∫≥', 'WS': 'Ëê®Êë©‰∫ö',
    'YE': '‰πüÈó®', 'YT': 'È©¨Á∫¶Áâπ', 'ZA': 'ÂçóÈùû', 'ZM': 'ËµûÊØî‰∫ö', 'ZW': 'Ê¥•Â∑¥Â∏ÉÈü¶'
};

        // Global State
        let allProxies = [];
        let filteredProxies = [];
        let currentPage = 1;
        let itemsPerPage = 20;
        let sortColumn = '';
        let sortDirection = 'asc';
        let searchTimeout = null;
        let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
        let savedFiltersList = JSON.parse(localStorage.getItem('savedFilters') || '[]'));
        let lastUpdateTime = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadSavedFilters();
            fetchProxyData();
        });

        // Fetch Proxy Data (‰ΩøÁî®ÂéüÂßãÈÄªËæë)
        async function fetchProxyData() {
            try {
                const timestamp = new Date().getTime();
                const dataSources = [
                    `alive.txt?t=${timestamp}`,
                    `../alive.txt?t=${timestamp}`,
                    `../data/alive.txt?t=${timestamp}`,
                    `https://raw.githubusercontent.com/GuoBing1989100/ProxyIP/main/Data/alive.txt?t=${timestamp}`
                ];

                let text = '';
                let success = false;

                for (const source of dataSources) {
                    try {
                        console.log(`Â∞ùËØïÂä†ËΩΩ: ${source}`);
                        const response = await fetch(source);
                        if (response.ok) {
                            text = await response.text();
                            if (text.trim() && !text.includes('<!DOCTYPE') && !text.includes('<html')) {
                                success = true;
                                console.log(`ÊàêÂäüÂä†ËΩΩ: ${source}`);
                                break;
                            }
                        }
                    } catch (e) {
                        console.log(`Âä†ËΩΩÂ§±Ë¥•: ${source}`);
                    }
                }

                if (!success || !text.trim()) {
                    throw new Error('Êó†Ê≥ïÂä†ËΩΩ alive.txt');
                }

                // Ëß£ÊûêÊï∞ÊçÆÔºà‰øùÁïôÂéüÂßãÈÄªËæëÔºâ
                const lines = text.trim().split('\n').filter(line => line.trim());
                allProxies = lines.map((line, index) => {
                    const parts = line.split(',');
                    if (parts.length < 3) return null;

                    const ip = parts[0].trim();
                    const port = parts[1].trim();
                    const countryCode = parts[2].trim().toUpperCase();

                    // ‰ΩøÁî® countryMap Ëé∑ÂèñÂõΩÂÆ∂ÂêçÁß∞
                    const countryName = countryNames[countryCode] || countryCode;
                    const company = parts.length > 3 ? parts.slice(3).join(',').trim() : 'Unknown';

                    return {
                        id: index,
                        ip: ip,
                        port: port,
                        countryCode: countryCode,
                        country: countryName,
                        isp: company,
                        selected: false
                    };
                }).filter(Boolean);

                filteredProxies = [...allProxies];
                currentPage = 1;
                lastUpdateTime = new Date();

                updateStatistics();
                populateFilters();
                renderTable();
                updateLastUpdate();
                showToast(`ÊàêÂäüÂä†ËΩΩ ${allProxies.length} ‰∏™‰ª£ÁêÜ`, 'success');
            } catch (error) {
                console.error('Êï∞ÊçÆÂä†ËΩΩÈîôËØØ:', error);
                showToast('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÂà∑Êñ∞È°µÈù¢', 'error');
                document.getElementById('tableBody').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 3rem; color: #f56565;"><b>‚ùå Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•</b><br><br>ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁÇπÂáªÂè≥‰∏äËßí"Âà∑Êñ∞Êï∞ÊçÆ"ÊåâÈíÆÈáçËØï</td></tr>';
            }
        }

        // Update Statistics
        function updateStatistics() {
            const countries = new Set(allProxies.map(p => p.country));

            animateValue('totalProxies', 0, allProxies.length, 1000);
            animateValue('totalCountries', 0, countries.size, 1000);
            animateValue('filteredCount', 0, filteredProxies.length, 1000);

            document.getElementById('currentCount').textContent = filteredProxies.length;
            document.getElementById('totalCount').textContent = allProxies.length;
        }

        // Animate Number
        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;

            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }

        // Populate Filters
        function populateFilters() {
            const countries = [...new Set(allProxies.map(p => p.country))].sort();
            populateSelect('countryFilter', countries);
        }

        function populateSelect(id, options) {
            const select = document.getElementById(id);
            const currentValue = select.value;
            select.innerHTML = `<option value="">ÂÖ®ÈÉ®${id.includes('country') ? 'ÂõΩÂÆ∂' : 'ISP'}</option>`;
            options.forEach(opt => {
                select.innerHTML += `<option value="${opt}">${opt}</option>`;
            });
            select.value = currentValue;
        }

        // Search Handler with Debounce
        function handleSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                applyFilters();
            }, 300);
        }

        // Apply Filters
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const country = document.getElementById('countryFilter').value;
            const port = document.getElementById('portFilter').value.trim();
            const isp = document.getElementById('ispFilter').value.trim().toLowerCase();
            const favoriteFilter = document.getElementById('favoriteFilter').value;

            filteredProxies = allProxies.filter(proxy => {
                const matchSearch = !searchTerm || 
                    proxy.ip.toLowerCase().includes(searchTerm) ||
                    proxy.country.toLowerCase().includes(searchTerm) ||
                    proxy.isp.toLowerCase().includes(searchTerm);

                const matchCountry = !country || proxy.country === country;
                const matchPort = !port || proxy.port.includes(port);
                const matchISP = !isp || proxy.isp.toLowerCase().includes(isp);
                const matchFavorite = !favoriteFilter || (favoriteFilter === 'favorites' && favorites.has(proxy.id));

                return matchSearch && matchCountry && matchPort && matchISP && matchFavorite;
            });

            currentPage = 1;
            updateStatistics();
            renderTable();
        }

        // Reset Filters
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('countryFilter').value = '';
            document.getElementById('portFilter').value = '';
            document.getElementById('ispFilter').value = '';
            document.getElementById('favoriteFilter').value = '';
            filteredProxies = [...allProxies];
            currentPage = 1;
            updateStatistics();
            renderTable();
        }

        // Sort Table
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            filteredProxies.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                if (column === 'port') {
                    aVal = parseInt(a.port);
                    bVal = parseInt(b.port);
                }

                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            // Update header classes
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });
            event.target.classList.add(`sorted-${sortDirection}`);

            renderTable();
        }

        // Render Table
        function renderTable() {
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageProxies = filteredProxies.slice(start, end);

            // Render desktop table
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (pageProxies.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">ÊöÇÊó†Êï∞ÊçÆ</td></tr>';
            } else {
                pageProxies.forEach(proxy => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="checkbox-cell">
                            <input type="checkbox" ${proxy.selected ? 'checked' : ''} onchange="toggleProxySelection(${proxy.id})">
                        </td>
                        <td class="ip-cell">${proxy.ip}</td>
                        <td>${proxy.port}</td>
                        <td>${proxy.country}</td>
                        <td>${proxy.isp}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="icon-btn copy" onclick="copyProxy(${proxy.id})" title="Â§çÂà∂">üìã</button>
                                <button class="icon-btn favorite ${favorites.has(proxy.id) ? 'active' : ''}" onclick="toggleFavorite(${proxy.id})" title="Êî∂Ëóè">‚≠ê</button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Render mobile cards
            const cardView = document.getElementById('cardView');
            cardView.innerHTML = '';
            pageProxies.forEach(proxy => {
                const card = document.createElement('div');
                card.className = 'proxy-card';
                card.innerHTML = `
                    <div class="proxy-card-header">
                        <div class="proxy-card-ip">${proxy.ip}:${proxy.port}</div>
                        <input type="checkbox" ${proxy.selected ? 'checked' : ''} onchange="toggleProxySelection(${proxy.id})">
                    </div>
                    <div class="proxy-card-body">
                        <div><span class="proxy-card-label">ÂõΩÂÆ∂:</span> ${proxy.country}</div>
                        <div><span class="proxy-card-label">ISP:</span> ${proxy.isp}</div>
                    </div>
                    <div class="proxy-card-actions">
                        <button class="icon-btn copy" onclick="copyProxy(${proxy.id})">üìã</button>
                        <button class="icon-btn favorite ${favorites.has(proxy.id) ? 'active' : ''}" onclick="toggleFavorite(${proxy.id})">‚≠ê</button>
                    </div>
                `;
                cardView.appendChild(card);
            });

            renderPagination();
        }

        // Render Pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredProxies.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (totalPages <= 1) return;

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.textContent = '‚Üê ‰∏ä‰∏ÄÈ°µ';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => changePage(currentPage - 1);
            pagination.appendChild(prevBtn);

            // Page numbers
            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'page-btn';
                firstBtn.textContent = '1';
                firstBtn.onclick = () => changePage(1);
                pagination.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '0 8px';
                    pagination.appendChild(ellipsis);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.className = 'page-btn';
                if (i === currentPage) btn.classList.add('active');
                btn.textContent = i;
                btn.onclick = () => changePage(i);
                pagination.appendChild(btn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '0 8px';
                    pagination.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.className = 'page-btn';
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => changePage(totalPages);
                pagination.appendChild(lastBtn);
            }

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.textContent = '‰∏ã‰∏ÄÈ°µ ‚Üí';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => changePage(currentPage + 1);
            pagination.appendChild(nextBtn);
        }

        function changePage(page) {
            currentPage = page;
            renderTable();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Toggle Proxy Selection
        function toggleProxySelection(id) {
            const proxy = allProxies.find(p => p.id === id);
            if (proxy) {
                proxy.selected = !proxy.selected;
                renderTable();
            }
        }

        function toggleSelectAll() {
            const checked = document.getElementById('selectAllCheckbox').checked;
            filteredProxies.forEach(proxy => {
                proxy.selected = checked;
            });
            renderTable();
        }

        function selectAll() {
            document.getElementById('selectAllCheckbox').checked = true;
            toggleSelectAll();
            closeAllDropdowns();
        }

        function deselectAll() {
            document.getElementById('selectAllCheckbox').checked = false;
            toggleSelectAll();
            closeAllDropdowns();
        }

        // Copy Functions
        function copyProxy(id) {
            const proxy = allProxies.find(p => p.id === id);
            if (proxy) {
                copyToClipboard(`${proxy.ip}:${proxy.port}`);
                showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
            }
        }

        function copySelected() {
            const selected = allProxies.filter(p => p.selected);
            if (selected.length === 0) {
                showToast('ËØ∑ÂÖàÈÄâÊã©‰ª£ÁêÜ', 'warning');
                return;
            }
            const text = selected.map(p => `${p.ip}:${p.port}`).join('\n');
            copyToClipboard(text);
            showToast(`Â∑≤Â§çÂà∂ ${selected.length} ‰∏™‰ª£ÁêÜ`, 'success');
            closeAllDropdowns();
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
        }

        // Export Functions
        function exportData(format) {
            const proxies = filteredProxies;
            let content = '';
            let filename = `proxies_${Date.now()}`;

            if (format === 'txt') {
                content = proxies.map(p => `${p.ip}:${p.port}`).join('\n');
                filename += '.txt';
            } else if (format === 'csv') {
                content = 'IP,Port,Country,ISP\n' + proxies.map(p => `${p.ip},${p.port},${p.country},${p.isp}`).join('\n');
                filename += '.csv';
            } else if (format === 'json') {
                content = JSON.stringify(proxies.map(p => ({
                    ip: p.ip,
                    port: p.port,
                    country: p.country,
                    isp: p.isp
                })), null, 2);
                filename += '.json';
            }

            downloadFile(content, filename);
            showToast(`Â∑≤ÂØºÂá∫ ${proxies.length} ‰∏™‰ª£ÁêÜ`, 'success');
            closeAllDropdowns();
        }

        function exportSelected() {
            const selected = allProxies.filter(p => p.selected);
            if (selected.length === 0) {
                showToast('ËØ∑ÂÖàÈÄâÊã©‰ª£ÁêÜ', 'warning');
                return;
            }
            const content = selected.map(p => `${p.ip}:${p.port}`).join('\n');
            downloadFile(content, `proxies_selected_${Date.now()}.txt`);
            showToast(`Â∑≤ÂØºÂá∫ ${selected.length} ‰∏™‰ª£ÁêÜ`, 'success');
            closeAllDropdowns();
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Toggle Favorite
        function toggleFavorite(id) {
            if (favorites.has(id)) {
                favorites.delete(id);
            } else {
                favorites.add(id);
            }
            localStorage.setItem('favorites', JSON.stringify([...favorites]));
            renderTable();
        }

        // Save Filter
        function saveCurrentFilter() {
            const filterName = prompt('ËØ∑ËæìÂÖ•Á≠õÈÄâÊñπÊ°àÂêçÁß∞:');
            if (!filterName) return;

            const filter = {
                name: filterName,
                country: document.getElementById('countryFilter').value,
                port: document.getElementById('portFilter').value,
                isp: document.getElementById('ispFilter').value,
                search: document.getElementById('searchInput').value
            };

            savedFiltersList.push(filter);
            localStorage.setItem('savedFilters', JSON.stringify(savedFiltersList));
            loadSavedFilters();
            showToast('Á≠õÈÄâÊñπÊ°àÂ∑≤‰øùÂ≠ò', 'success');
        }

        function loadSavedFilters() {
            const container = document.getElementById('savedFilters');
            container.innerHTML = '';
            savedFiltersList.forEach((filter, index) => {
                const tag = document.createElement('div');
                tag.className = 'saved-filter-tag';
                tag.innerHTML = `
                    <span onclick="applySavedFilter(${index})">${filter.name}</span>
                    <span class="remove" onclick="removeSavedFilter(${index})">‚úï</span>
                `;
                container.appendChild(tag);
            });
        }

        function applySavedFilter(index) {
            const filter = savedFiltersList[index];
            document.getElementById('countryFilter').value = filter.country;
            document.getElementById('portFilter').value = filter.port;
            document.getElementById('ispFilter').value = filter.isp;
            document.getElementById('searchInput').value = filter.search;
            applyFilters();
            showToast(`Â∑≤Â∫îÁî®Á≠õÈÄâ: ${filter.name}`, 'success');
        }

        function removeSavedFilter(index) {
            savedFiltersList.splice(index, 1);
            localStorage.setItem('savedFilters', JSON.stringify(savedFiltersList));
            loadSavedFilters();
        }

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');
            if (newTheme === 'dark') {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Êòé‰∫ÆÊ®°Âºè';
            } else {
                icon.textContent = 'üåô';
                text.textContent = 'ÊöóÈªëÊ®°Âºè';
            }
        }

        function loadTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');
            if (theme === 'dark') {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Êòé‰∫ÆÊ®°Âºè';
            }
        }

        // Refresh Data
        function refreshData() {
            showToast('Ê≠£Âú®Âà∑Êñ∞Êï∞ÊçÆ...', 'success');
            fetchProxyData();
        }

        // Update Last Update Time
        function updateLastUpdate() {
            if (!lastUpdateTime) return;

            const element = document.getElementById('lastUpdate');
            const now = new Date();
            const diff = Math.floor((now - lastUpdateTime) / 1000 / 60);

            if (diff < 1) {
                element.textContent = 'ÂàöÂàöÊõ¥Êñ∞';
            } else if (diff < 60) {
                element.textContent = `${diff}ÂàÜÈíüÂâçÊõ¥Êñ∞`;
            } else {
                const hours = Math.floor(diff / 60);
                element.textContent = `${hours}Â∞èÊó∂ÂâçÊõ¥Êñ∞`;
            }
        }

        // Update time every minute
        setInterval(updateLastUpdate, 60000);

        // Dropdown Toggle
        function toggleDropdown(id) {
            closeAllDropdowns();
            const dropdown = document.getElementById(id).parentElement;
            dropdown.classList.toggle('active');
            event.stopPropagation();
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
        }

        document.addEventListener('click', closeAllDropdowns);

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');

            toast.className = `toast ${type}`;

            if (type === 'success') icon.textContent = '‚úÖ';
            else if (type === 'error') icon.textContent = '‚ùå';
            else if (type === 'warning') icon.textContent = '‚ö†Ô∏è';

            msg.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
